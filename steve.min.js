function GoSteveGo(){null!=localStorage.getItem("state"),PostQuestion()}function AnimateChats(){$("#chatArea").animate({scrollTop:$("#chatArea").prop("scrollHeight")})}function HighlightQuestion(){}function PostQuestion(){if(StopTimer(),interim_count!=max_interim_count&&1!=success){var e=$('<div class="bubble bot">');1==interim&&max_interim_count>interim_count?(e.html(questions[questions.length-1]),interim_count++):1==fallback?e.html(fallbackquestions[state]):e.html(questions[state]),$("#chatArea").append(e),$(e).wrap('<div class="bubble_container"></div>'),$('<span class="glyphicon glyphicon-record bot_avatar"></span>').insertBefore(e),AnimateChats(),StartTimer()}}function StopTimer(){timer&&timer.kill()}function StartTimer(){null==timer?timer=TimersJS.timer(1e4,function(e,t){NoAnswerResponse()}):timer.restart()}function SaveState(e){responses[state]=e,done[state]=!0,AllocateVariables(e)}function SaveSteveLocally(){localStorage.setItem("respnoses",JSON.stringify(responses)),localStorage.setItem("state",state),localStorage.setItem("doneArray",JSON.stringify(done))}function ClearSteveLocally(){localStorage.removeItem("respnoses"),localStorage.removeItem("state"),localStorage.removeItem("doneArray")}function RevampSteve(){responses=JSON.parse(localStorage.getItem("respnoses")),state=JSON.parse(localStorage.getItem("state")),done=JSON.parse(localStorage.getItem("doneArray")),Invalidate(),PostQuestion()}function AttachEmail(){ga("set","userId",email);var e=email_api;$.getJSON(e,{email:email},function(e){"OK"==e||alert("failed to attach email")})}function AttachAddress(){ga("send","event","UserInfo","address",JSON.stringify(responses));var e=address_api;$.post(e,{name:responses[0],zipcode:responses[2],address:responses[3],phone:responses[4],city:city_name,state_name:state_name,country_name:country_name},function(e){"OK"==e||alert("fail to attach address")})}function CompleteCODOrder(){var e="cod/automated/checkout";$.ajax({type:"GET",url:e,success:function(e){"error"==e?alert("Order not completed"):order_id=e},dataType:"json",async:!1})}function ReplaceVariables(e,t){for(var a=questions.length,n=0;a>n;n++)questions[n]=questions[n].replace(e,t),fallbackquestions[n]=fallbackquestions[n].replace(e,t),errorquestions[n]=errorquestions[n].replace(e,t)}function AllocateVariables(e){switch(state+1){case 1:var t=e.split(" ")[0];ReplaceVariables(firstname,t);break;case 2:email=e,AttachEmail(e);break;case 3:$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+e,success:function(t){if(0==t.length||"ZERO_RESULTS"==t.status)alert("Invalid Pincode");else{var a=t.results[0].formatted_address.replace(" "+e,"");ReplaceVariables(full_address,a),a=a.split(", "),city_name=a[0],state_name=a[1],country_name=a[a.length-1]}},dataType:"json",async:!1});break;case 4:break;case 5:AttachAddress();break;case 6:success=!0,StopTimer()}}function NoAnswerResponse(){timer&&(StopTimer(),HighlightQuestion(),StartTimer())}function AnalyzeAnswer(e){StopTimer(),$(".spinner").hide();var t=!1;switch(validationType[state]){case"string":t=validateName(e);break;case"email":t=validateEmail(e);break;case"pincode":t=validatePincode(e);break;case"address":t=validateAddress(e);break;case"mobile":t=validateMobile(e);break;case"payment":t=validatePayment();break;case"order":t=validateOrder()}t?(SaveState(e),SetCurrentStep(state+1),SaveSteveLocally(),Invalidate(),PostQuestion()):(error=!0,WrongAnswerResponse())}function WrongAnswerResponse(){StopTimer();var e=$('<div class="bubble bot">');e.html(errorquestions[state]),$("#chatArea").append(e),$(e).wrap('<div class="bubble_container"></div>'),$('<span class="glyphicon glyphicon-record bot_avatar"></span>').insertBefore(e),AnimateChats(),StartTimer()}function GetCurrentStep(){return state}function SetCurrentStep(e){state=e}function Invalidate(){fallback=!1,timer=null,interim=!1,interim_count=0}function validateEmail(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)}function validateName(e){return!0}function validateAddress(e){return!0}function validatePincode(e){var t=!1;return e.length>2&&$.ajax({type:"GET",url:"https://maps.googleapis.com/maps/api/geocode/json?address="+e,success:function(e){t=0==e.length||"ZERO_RESULTS"==e.status?!1:!0},dataType:"json",async:!1}),t}function validateMobile(e){return""==e||isNaN(e)||10!=e.length?!1:!0}function validatePayment(){return!1}function validateOrder(){return!0}!function(){function e(e){return n.push(e),n.length-1}function t(e){n.splice(e.id,1)}var a=this,n=[],i=[],r=function(t,a){var n=!1;return"undefined"==typeof t&&(n=!0),this._systemTimerReference=null,this._interval=t,this._callback=a,this._running=!1,this._paused=!1,this._systemTimerFunction=null,this._canBeKilled=!0,this._state={},n||(this.id=e(this)),"undefined"==typeof arguments[2]&&this.restart(),this};r.prototype.state=function(e,t){if("object"==typeof e)this._state=e;else{if("string"==typeof e&&"undefined"==typeof t)return this._state[e];if("string"!=typeof e||"undefined"==typeof t)return this._state;this._state[e]=t}},r.prototype.kill=function(){return this._canBeKilled?(TimersJS.cleanupCallback(this._systemTimerFunction),this.cancel(),t(this),this._systemTimerReference=null,null):this},r.prototype.systemTimer=function(e){return"undefined"!=typeof e&&(this._systemTimerReference=e),this._systemTimerReference},r.prototype.isRunning=function(){return this._running},r.prototype.cancel=function(){return a.clearTimeout(this.systemTimer()),this._systemTimerReference=null,this._running=!1,this},r.prototype.pause=function(){return this.cancel(),this._paused=!0,this},r.prototype.restart=function(){return this.cancel(),this.systemTimer(a.setTimeout(this.callback(),this.interval())),this._running=!0,this._paused=!1,this},r.prototype.killable=function(e){return"undefined"!=typeof e&&(this._canBeKilled=e),this._canBeKilled},r.prototype.callback=function(e){return"undefined"!=typeof e?(this._callback=e,this._systemTimerFunction=null,this.isRunning()&&this.restart()):null===this._systemTimerFunction&&(this._systemTimerFunction=function(){var e=arguments.callee,t=Date.now(),a=t-e.lastTime;e.lastTime=t,e.timerCallback&&e.timerCallback.call(e.timer,a,t)},this._systemTimerFunction.timerCallback=this._callback,this._systemTimerFunction.timer=this,this._systemTimerFunction.lastTime=Date.now()),this._systemTimerFunction},r.prototype.interval=function(e){return"undefined"!=typeof e&&(this.cancel(),this._interval=e),this._interval};var s=function(e,t){var a=function(e,t){var a=arguments.callee;a.timerCallback&&a.timerCallback.call(this,e,t),this.restart()};a.timerCallback=t,r.call(this,e,a)};s.prototype=new r,s.base=r.prototype;var o=function(e,t,n,i){var s=function(e,t){var n=arguments.callee;n.repetitions-->0?(n.callbackFunction.call(this,n.totalRepetitions,e,t),n.totalRepetitions++,this.restart()):(n.completionCallback&&n.completionCallback.call(this,e,t),this.kill(),a.TimersJS.cleanupCallback(n))};s.callbackFunction=t,s.completionCallback=i,s.repetitions=n,s.totalRepetitions=0,r.call(this,e,s)};o.prototype=new r,o.base=r.prototype;var l=function(e,t){var n=function(e,t){arguments.callee.callbackFunction&&(arguments.callee.callbackFunction.call(this,e,t),this.kill(),a.TimersJS.cleanupCallback(arguments.callee))};n.callbackFunction=t,r.call(this,e,n)};l.prototype=new r,l.base=r.prototype,l.prototype.restart=function(){(this._paused||!this._running)&&l.base.restart.call(this)};var c=function(e,t,n,i){var r=function(e,t){var n=arguments.callee;n.interval.kill(),n.intervalCompletionCallback.call(this,e,t),a.TimersJS.cleanupCallback(n)};r.interval=new s(n,i),r.intervalCompletionCallback=t,l.call(this,e,r)};c.prototype=new l,c.base=l.prototype,a.TimersJS={cleanupCallback:function(e){i.push(e)},poolSize:function(){return n.length},pauseAllTimers:function(){for(var e=0;e<n.length;e++)n[e].pause()},restartAllTimers:function(){for(var e=0;e<n.length;e++)n[e].restart()},cancelAllTimers:function(){for(var e=0;e<n.length;e++)n[e].cancel()},killAllTimers:function(){for(var e=[];n.length>0;){var t=n.shift();t.killable()?t.kill():e.push(t)}n=e},timer:function(e,t){return new r(e,t)},repeater:function(e,t){return new s(e,t)},multi:function(e,t,a,n){return new o(e,a,t,n)},oneShot:function(e,t){return new l(e,t)},trigger:function(e,t,a,n){return new c(e,t,a,n)}},a.setInterval(function(){for(;i.length>0;)i[0]=null,i.shift()},500)}(),$(document).on("click",".try_steve",function(){ClearSteveLocally(),$("#chatBox").show(),GoSteveGo()}),$("#textArea").keyup(function(e){if(13==e.keyCode){var t=$("#textArea").val(),a=$('<div class="bubble master">');a.html(t),$("#chatArea").append(a),$(a).wrap('<div class="bubble_container"></div>'),$('<span class="glyphicon glyphicon-user pull-right user_avatar"></span>').insertBefore(a),AnimateChats(),$("#textArea").val(""),$(".spinner").show(),setTimeout(function(){AnalyzeAnswer(t)},1300)}else timer&&timer.restart()}),$(document).on("click","#assisted_checkout_btn",function(){if($(".bubble").length>0)$("#chatBox").addClass("hvr-buzz-shake"),setTimeout(function(){$("#chatBox").removeClass("hvr-buzz-shake")},500);else{var e=setInterval(function(){$(".chat_header").toggleClass("backgroundBlink")},500);ClearSteveLocally(),$("#chatBox").show(),GoSteveGo(),$(document).on("focus","#textArea",function(){clearInterval(e),$(".chat_header").css("background-color","#A864A7")})}}),$(document).on("click",".chat_header",function(){$("#chatArea, #chatType, .minimize_chat").toggle()});var steps=["name","email","pincode","address","mobile","payment","registration","intermediate"],done=[!1,!1,!1,!1,!1,!1,!1,!1],responseValidators=["string","email","pincode","text","mobile","NA","NA","Yes"],steve_succeded=!1,firstname="(firstname)",country_name="",state_name="",city_name="",email="email",order_number="(order_number)",total="(total)",category="(category)",full_address="(Full Address)",cod_option="",email_api="/associate-email/api",address_api="/associate-addres/api",new_total="$999",cod_url="<a href='/cod_steve.html'>",pay_url="<a href='/pay_steve.html'><b>HERE</b></a>.";null!=new_total.match("$")&&(cod_option=" Or pay "+cod_url+"Cash on Delivery</a>.");var questions=["Hello there, I am Steve, your cashier. I am here to make your checkout easier. To start with, what is your <b>name</b>?","Nice to meet you, <b>"+firstname+"</b>. And that's a nice pick! Could you type your <b>email</b> for me?","Thanks. To process this order, I need your <b>zipcode</b>. Can you type it for me?","<b>"+firstname+"</b>, Looks like you live in "+full_address+". Can you give me your <b>full street address</b>?","Perfect! And <b>10 digit mobile number</b> for delivery.","Thanks! That would be all, <b>"+firstname+"</b>. Your total amount is "+total+". To pay securely online, click "+pay_url+cod_option,"Your order has been placed successfully. Your order id is "+order_number+". I am happy to serve you.","I've created an account for you on VioetStreet, for you to receive our exlusive fresh catalogue and notification of new boutiques & sales","Looks like you are not there. If you are there, type Yes"],errorquestions=["Umm, name please","Looks like <b>email</b> you entered is <b>invalid</b>. Please type it again","Looks like <b>pincode</b> you entered is <b>invalid</b>. Please type it again","Umm, Street address?","Looks like <b>phone number</b> you've entered is <b>invalid</b>. Please type it again","<b>"+firstname+"</b>. Your total amount is "+total+". To pay securely online, click <a href='/payu/automated/checkout'><b>HERE</b></a>."+cod_option,"Your order has been placed successfully. Your order id is [XXX-XXX-XXX]. Steve is happy to serve you.","I've created an account for you on VioetStreet, for you to receive our exlusive fresh catalogue and notification of new boutiques & sales","Looks like you are not there. If you are there, type Yes"],fallbackquestions=["Umm, name please","Umm, email ma'am","Umm, pincode ma'am","Umm, Street address?","I need your 10 digit phone number.",firstname+", <a href='/payu/automated/checkout'>Online</a> or <a href='/cod/automated/checkout'>Cash on Delivery</a>","Your order has been placed successfully. Your order id is [XXX-XXX-XXX]. Steve is happy to serve you.","I've created an account for you on VioetStreet, for you to receive our exlusive fresh catalogue and notification of new boutiques & sales","Looks like you are not there. If you are there, type 'Yes'"],validationType=["string","email","pincode","address","mobile","link","order. Your order id is [XXX-XXX-XXX]. Steve is happy to serve you.","I've created an account for you on VioetStreet, for you to receive our exlusive fresh catalogue and notification of new boutiques & sales","Looks like you are not there. If you are there, type 'Yes'"],state=0,interim=!1,interim_count=0,max_interim_count=3,timer=null,fallback=!1,error=!1,success=!1,responses=[];ReplaceVariables(total,new_total);